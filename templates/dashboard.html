{% extends "base.html" %}

{% block title %}Dashboard - Laundry Booking System{% endblock %}

{% block body_class %}home-page{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="text-center mb-5">
            <div class="mb-4">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SRIT Logo" class="img-fluid" style="max-height: 150px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
            </div>
            <h1 class="display-4 mb-3" style="color: white;">
                Welcome to SRIT Laundry Booking System
            </h1>
            <p class="lead" style="color: #e9ecef;">
                Book Your Laundry Slots Easily and Efficiently
            </p>
        </div>

        {% if user %}
            <!-- Quick Stats Dashboard -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card text-center" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px;">
                        <div class="card-body py-3">
                            <h4 id="available-slots">12</h4>
                            <small>Available Slots Today</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 15px;">
                        <div class="card-body py-3">
                            <h4 id="user-bookings">0</h4>
                            <small>Your Active Bookings</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border-radius: 15px;">
                        <div class="card-body py-3">
                            <h4 id="next-slot">2:00 PM</h4>
                            <small>Next Available</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center" style="background: linear-gradient(135deg, #6f42c1, #563d7c); color: white; border-radius: 15px;">
                        <div class="card-body py-3">
                            <h4 id="queue-status">Low</h4>
                            <small>Current Queue</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card h-100" style="border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div class="card-body text-center">
                            <div style="background: linear-gradient(135deg, #007bff, #0056b3); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            </div>
                            <h5 class="card-title">Book New Slot</h5>
                            <p class="card-text">Schedule your laundry time and select your preferred wash options.</p>
                            <a href="{{ url_for('book') }}" class="btn btn-primary" style="border-radius: 25px; padding: 10px 30px;">
                                Book Now
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100" style="border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div class="card-body text-center">
                            <div style="background: linear-gradient(135deg, #17a2b8, #138496); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            </div>
                            <h5 class="card-title">Booking History</h5>
                            <p class="card-text">View your past and current laundry bookings and their status.</p>
                            <a href="{{ url_for('history', student_name=session.username) }}" class="btn btn-info" style="border-radius: 25px; padding: 10px 30px;">
                                View History
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- Feature Preview Cards -->
            <div class="row g-4 mb-4">
                <div class="col-md-12">
                    <div class="card" style="background: linear-gradient(135deg, rgba(0,123,255,0.1), rgba(0,86,179,0.1)); border: none; border-radius: 15px;">
                        <div class="card-body text-center py-4">
                            <h5 style="color: #007bff;">System Features</h5>
                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <small class="quick-action-btn">Real-time Booking</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="quick-action-btn">UPI Payments</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="quick-action-btn">Smart Scheduling</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="quick-action-btn">24/7 Support</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card h-100" style="border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div class="card-body text-center">
                            <div style="background: linear-gradient(135deg, #28a745, #20c997); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            </div>
                            <h5 class="card-title">Student Login</h5>
                            <p class="card-text">Access your account to book laundry slots and manage bookings.</p>
                            <a href="{{ url_for('student_login') }}" class="btn btn-success" style="border-radius: 25px; padding: 10px 30px;">
                                Login
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100" style="border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div class="card-body text-center">
                            <div style="background: linear-gradient(135deg, #ffc107, #fd7e14); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            </div>
                            <h5 class="card-title">New Student</h5>
                            <p class="card-text">Create a new account to start booking laundry slots.</p>
                            <a href="{{ url_for('register') }}" class="btn btn-warning" style="border-radius: 25px; padding: 10px 30px;">
                                Register
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card h-100" style="border-radius: 15px; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <div class="card-body text-center position-relative">
                            <div style="background: linear-gradient(135deg, #dc3545, #c82333); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
                            </div>
                            <h5 class="card-title">Admin Access</h5>
                            <p class="card-text">Administrative access to manage all bookings and system operations.</p>
                            <a href="{{ url_for('admin_login') }}" class="btn btn-danger" style="border-radius: 25px; padding: 10px 30px;">
                                Admin Login
                            </a>
                            <div class="notification-badge">3</div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}


    </div>
</div>

<!-- Chatbot Widget -->
<div id="chatbot-widget" style="position: fixed; bottom: 20px; left: 20px; z-index: 1000;">
    <div id="chatbot-button" style="width: 60px; height: 60px; background: linear-gradient(135deg, #007bff, #0056b3); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,123,255,0.3); transition: all 0.3s ease;" onclick="toggleChatbot()">
        <div style="color: white; font-size: 18px; font-weight: bold;">Chat</div>
    </div>
    
    <div id="chatbot-window" style="display: none; position: absolute; bottom: 70px; left: 0; width: 320px; height: 400px; background: white; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2); border: 1px solid #e9ecef;">
        <div style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: between; align-items: center;">
            <h6 style="margin: 0; font-weight: 600;">SRIT Support Chat</h6>
            <button onclick="toggleChatbot()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; margin-left: auto;">×</button>
        </div>
        
        <div id="chat-messages" style="height: 280px; padding: 15px; overflow-y: auto; background: #f8f9fa;">
            <div style="background: #e3f2fd; padding: 10px; border-radius: 10px; margin-bottom: 10px;">
                <small style="color: #1976d2; font-weight: 500;">SRIT Assistant</small>
                <p style="margin: 5px 0 0 0; font-size: 14px;">Hello! I'm here to help you with the laundry booking system. How can I assist you today?</p>
            </div>
        </div>
        
        <div style="padding: 15px; border-top: 1px solid #e9ecef;">
            <div style="display: flex; gap: 8px;">
                <input type="text" id="chat-input" placeholder="Type your message..." style="flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 8px 15px; font-size: 14px;" onkeypress="handleChatEnter(event)">
                <button onclick="sendMessage()" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer;">➤</button>
            </div>
        </div>
    </div>
</div>

<script>
function toggleChatbot() {
    const window = document.getElementById('chatbot-window');
    const button = document.getElementById('chatbot-button');
    
    if (window.style.display === 'none') {
        window.style.display = 'block';
        button.style.transform = 'scale(0.9)';
    } else {
        window.style.display = 'none';
        button.style.transform = 'scale(1)';
    }
}

function handleChatEnter(event) {
    if (event.key === 'Enter') {
        sendMessage();
    }
}

function sendMessage() {
    const input = document.getElementById('chat-input');
    const messages = document.getElementById('chat-messages');
    const message = input.value.trim();
    
    if (message) {
        // Add user message
        const userMsg = document.createElement('div');
        userMsg.style.cssText = 'text-align: right; margin-bottom: 10px;';
        userMsg.innerHTML = `<div style="background: #007bff; color: white; padding: 8px 12px; border-radius: 15px; display: inline-block; max-width: 80%; font-size: 14px;">${message}</div>`;
        messages.appendChild(userMsg);
        
        // Add bot response after delay
        setTimeout(() => {
            const botMsg = document.createElement('div');
            botMsg.style.cssText = 'background: #e3f2fd; padding: 10px; border-radius: 10px; margin-bottom: 10px;';
            
            let response = getBotResponse(message.toLowerCase());
            botMsg.innerHTML = `<small style="color: #1976d2; font-weight: 500;">SRIT Assistant</small><p style="margin: 5px 0 0 0; font-size: 14px;">${response}</p>`;
            messages.appendChild(botMsg);
            messages.scrollTop = messages.scrollHeight;
        }, 1000);
        
        input.value = '';
        messages.scrollTop = messages.scrollHeight;
    }
}

function getBotResponse(message) {
    if (message.includes('book') || message.includes('slot')) {
        return 'To book a laundry slot, please login to your student account and click "Book New Slot". You can select your preferred time, wash type, and payment method.';
    } else if (message.includes('payment') || message.includes('pay')) {
        return 'We accept Cash, UPI (PhonePe, Google Pay), Credit/Debit Cards, and Online payments. You can scan the QR code for UPI payments.';
    } else if (message.includes('time') || message.includes('hours')) {
        return 'Laundry slots are available from 6:00 AM to 10:00 PM in 2-hour time blocks. You can select your preferred time during booking.';
    } else if (message.includes('cancel') || message.includes('change')) {
        return 'To cancel or modify your booking, please contact the admin or check your booking history. Admins can help with booking changes.';
    } else if (message.includes('help') || message.includes('support')) {
        return 'I can help you with booking slots, payment methods, time schedules, and general system usage. What specific question do you have?';
    } else if (message.includes('login') || message.includes('account')) {
        return 'Students can login with their registered username and password. New students need to register first. Admins have separate login access.';
    } else {
        return 'Thank you for your question! For detailed assistance, you can visit the Help section or contact the admin. I can help with booking, payments, schedules, and account questions.';
    }
}
</script>
{% endblock %}
